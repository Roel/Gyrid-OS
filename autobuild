#!/bin/bash

build () {
    # Build iso image
    ./build.sh iso 2>&1 | tee build_iso-$VERSION.log
    mv voyage-current.iso ../voyage-ugent-$VERSION.iso

    # Build tar image
    ./build.sh tar 2>&1 | tee build_tar-$VERSION.log
    mv voyage-current.tar.bz2 ../voyage-ugent-$VERSION.tar.bz2

    # Move build logs
    mv build_*.log ../

    # Tar up configuration and compute md5 hashes
    cd ..
    tar cvjf voyage-ugent-config-$VERSION.tar.bz2 voyage-build-config/config \
        voyage-build-config/build.sh voyage-build-config/autobuild
    md5sum build_*.log voyage-ugent* > MD5SUMS.$VERSION
    cd -
}

VERSION="i686"
build

sed -i '/LH_LINUX_FLAVOURS/{s/ugent-i686/ugent-geode/}' config/chroot

VERSION="geode"
build

sed -i '/LH_LINUX_FLAVOURS/{s/ugent-geode/ugent-i686/}' config/chroot
